generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Role {
  id          Int      @id @default(autoincrement()) @map("id_rol")
  name        String   @unique @map("nombre") @db.VarChar(100)
  description String?  @map("descripcion")
  createdAt   DateTime @default(now()) @map("fecha_creacion") @db.Timestamp(6)
  users       User[]

  @@map("roles")
}

model User {
  id             Int            @id @default(autoincrement()) @map("id_usuario")
  fullName       String         @map("nombre_completo") @db.VarChar(200)
  username       String         @unique @map("usuario") @db.VarChar(100)
  email          String         @unique @map("correo") @db.VarChar(200)
  password       String         @map("clave") @db.VarChar(255)
  roleId         Int?           @map("id_rol")
  lastConnection DateTime?      @map("ultima_conexion") @db.Timestamp(6)
  isActive       Boolean        @default(true) @map("activo")
  registeredAt   DateTime       @default(now()) @map("fecha_registro") @db.Timestamp(6)
  galleryImages  GalleryImage[]
  auditLogs      AuditLog[]
  publications   Publication[]
  role           Role?          @relation(fields: [roleId], references: [id])

  @@index([email], map: "idx_usuarios_correo")
  @@index([username], map: "idx_usuarios_usuario")
  @@index([roleId], map: "idx_usuarios_rol")
  @@map("usuarios")
}

model Publication {
  id             Int              @id @default(autoincrement()) @map("id_publicacion")
  title          String           @map("titulo") @db.VarChar(255)
  slug           String           @unique @map("slug") @db.VarChar(255)
  description    String?          @map("descripcion")
  content        String           @map("contenido")
  mainImage      String?          @map("imagen_principal") @db.VarChar(500)
  status         String           @default("borrador") @map("estado") @db.VarChar(50)
  authorId       Int?             @map("id_usuario")
  categoryId     Int?             @map("id_categoria")
  createdAt      DateTime         @default(now()) @map("fecha_creacion") @db.Timestamp(6)
  updatedAt      DateTime         @default(now()) @map("fecha_actualizacion") @db.Timestamp(6)
  videoThumbnail String?          @map("miniatura_video") @db.VarChar(500)
  comments       Comment[]
  tags           PublicationTag[]
  category       Category?        @relation(fields: [categoryId], references: [id])
  author         User?            @relation(fields: [authorId], references: [id])
  visits         Visit[]

  @@index([slug], map: "idx_publicaciones_slug")
  @@index([status], map: "idx_publicaciones_estado")
  @@index([authorId], map: "idx_publicaciones_usuario")
  @@index([categoryId], map: "idx_publicaciones_categoria")
  @@map("publicaciones")
}

model Tag {
  id           Int              @id @default(autoincrement()) @map("id_etiqueta")
  name         String           @unique @map("nombre") @db.VarChar(100)
  slug         String           @unique @map("slug") @db.VarChar(150)
  description  String?          @map("descripcion")
  publications PublicationTag[]

  @@map("etiquetas")
}

model PublicationTag {
  id            Int         @id @default(autoincrement()) @map("id_publicacion_etiqueta")
  publicationId Int         @map("id_publicacion")
  tagId         Int         @map("id_etiqueta")
  tag           Tag         @relation(fields: [tagId], references: [id], onDelete: Cascade)
  publication   Publication @relation(fields: [publicationId], references: [id], onDelete: Cascade)

  @@unique([publicationId, tagId])
  @@index([publicationId], map: "idx_pub_etiq_publicacion")
  @@index([tagId], map: "idx_pub_etiq_etiqueta")
  @@map("publicacion_etiqueta")
}

model Comment {
  id            Int         @id @default(autoincrement()) @map("id_comentario")
  publicationId Int         @map("id_publicacion")
  name          String?     @map("nombre") @db.VarChar(150)
  message       String      @map("mensaje")
  isApproved    Boolean     @default(false) @map("aprobado")
  createdAt     DateTime    @default(now()) @map("fecha_creacion") @db.Timestamp(6)
  publication   Publication @relation(fields: [publicationId], references: [id], onDelete: Cascade)
  reactions     Reaction[]

  @@index([publicationId], map: "idx_comentarios_publicacion")
  @@index([isApproved], map: "idx_comentarios_aprobado")
  @@map("comentarios")
}

model Reaction {
  id           Int      @id @default(autoincrement()) @map("id_reaccion")
  commentId    Int?     @map("id_comentario")
  name         String?  @map("nombre") @db.VarChar(150)
  reactionType String   @default("like") @map("tipo_reaccion") @db.VarChar(50)
  createdAt    DateTime @default(now()) @map("fecha_creacion") @db.Timestamp(6)
  comment      Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@index([commentId], map: "idx_reacciones_comentario")
  @@map("reacciones")
}

model ContactSubject {
  id          Int              @id @default(autoincrement()) @map("id_asunto")
  name        String           @unique @map("nombre") @db.VarChar(200)
  description String?          @map("descripcion")
  messages    ContactMessage[]

  @@map("asuntos_contacto")
}

model ContactMessage {
  id        Int             @id @default(autoincrement()) @map("id_mensaje")
  name      String          @map("nombre") @db.VarChar(200)
  email     String          @map("correo") @db.VarChar(200)
  phone     String?         @map("telefono") @db.VarChar(50)
  subjectId Int?            @map("id_asunto")
  message   String          @map("mensaje")
  isReplied Boolean         @default(false) @map("respondido")
  sentAt    DateTime        @default(now()) @map("fecha_envio") @db.Timestamp(6)
  repliedAt DateTime?       @map("fecha_respuesta") @db.Timestamp(6)
  subject   ContactSubject? @relation(fields: [subjectId], references: [id])

  @@index([isReplied], map: "idx_mensajes_respondido")
  @@map("mensajes_contacto")
}

model DestinationEmail {
  id       Int     @id @default(autoincrement()) @map("id_correo_destino")
  name     String  @map("nombre") @db.VarChar(200)
  email    String  @unique @map("correo") @db.VarChar(200)
  isActive Boolean @default(true) @map("activo")

  @@map("correos_destino")
}

model Director {
  id           Int      @id @default(autoincrement()) @map("id_directivo")
  fullName     String   @map("nombre_completo") @db.VarChar(200)
  position     String?  @map("cargo") @db.VarChar(200)
  photo        String?  @map("foto") @db.VarChar(500)
  description  String?  @map("descripcion")
  status       Boolean  @default(true) @map("estado")
  registeredAt DateTime @default(now()) @map("fecha_registro") @db.Timestamp(6)

  @@map("directivos")
}

model AuditLog {
  id               Int      @id @default(autoincrement()) @map("id_accion")
  userId           Int?     @map("id_usuario")
  action           String   @map("accion") @db.VarChar(255)
  affectedTable    String?  @map("tabla_afectada") @db.VarChar(100)
  affectedRecordId Int?     @map("id_registro")
  details          String?  @map("detalles")
  performedAt      DateTime @default(now()) @map("fecha_accion") @db.Timestamp(6)
  user             User?    @relation(fields: [userId], references: [id])

  @@index([userId], map: "idx_historial_usuario")
  @@index([performedAt], map: "idx_historial_fecha")
  @@map("historial_acciones")
}

model Visit {
  id            Int         @id @default(autoincrement()) @map("id_visita")
  publicationId Int         @map("id_publicacion")
  ipAddress     String?     @map("direccion_ip") @db.VarChar(45)
  userAgent     String?     @map("user_agent")
  visitedAt     DateTime    @default(now()) @map("fecha_visita") @db.Timestamp(6)
  publication   Publication @relation(fields: [publicationId], references: [id], onDelete: Cascade)

  @@index([publicationId], map: "idx_visitas_publicacion")
  @@index([visitedAt], map: "idx_visitas_fecha")
  @@map("visitas")
}

model Category {
  id           Int           @id @default(autoincrement()) @map("id_categoria")
  name         String        @unique @map("nombre") @db.VarChar(100)
  slug         String        @unique @map("slug") @db.VarChar(150)
  description  String?       @map("descripcion")
  icon         String?       @map("icono") @db.VarChar(100)
  color        String?       @map("color") @db.VarChar(50)
  order        Int           @default(0) @map("orden")
  createdAt    DateTime      @default(now()) @map("fecha_creacion") @db.Timestamp(6)
  publications Publication[]

  @@index([slug], map: "idx_categorias_slug")
  @@map("categorias")
}

model GalleryImage {
  id          Int      @id @default(autoincrement()) @map("id_imagen")
  title       String   @map("titulo") @db.VarChar(255)
  description String?  @map("descripcion")
  imageUrl    String   @map("url_imagen") @db.VarChar(500)
  type        String   @default("imagen") @map("tipo") @db.VarChar(50)
  authorId    Int?     @map("id_usuario")
  uploadedAt  DateTime @default(now()) @map("fecha_subida") @db.Timestamp(6)
  author      User?    @relation(fields: [authorId], references: [id])

  @@index([type], map: "idx_galeria_tipo")
  @@map("galeria")
}
